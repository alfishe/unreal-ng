#pragma once
#include "pch.h"

#include <exception>
#include <map>

namespace z80_test
{

enum Z80Flags : uint8_t
{
	FLAG_CF = 0x01,
	FLAG_NF = 0x02,
	FLAG_PV = 0x04,
	FLAG_F3 = 0x08,
	FLAG_HF = 0x10,
	FLAG_F5 = 0x20,
	FLAG_ZF = 0x40,
	FLAG_SF = 0x80
};

// Instruction types
// 1. Unconditional
// 2. Conditional (flags involved)
// 3. Unconditional jumps
// 4. Conditional jumps
// 5. Unconditional calls (stack involved)
// 6. Conditional calls (stack involved)
// 7. Interrupts

struct OpDescriptor
{
	uint8_t opcode;
	bool	isPrefix;
	bool	isConditional;

	uint8_t bytes;
	uint8_t instruction[4];	// Byte 0: Opcode, Byte 1: 0xF1|0x00, Byte 2: 0xF2| 0x00, Byte 3: always 0
	uint8_t cycles;
};

struct ConditionalTimings
{
	uint8_t opcode;

	uint8_t met_cycles;
	uint8_t not_met_cycles;
	uint8_t condition_flags;
};

struct CodeSnippet
{

};

class OpcodeException : public std::runtime_error
{
public:
	OpcodeException(const std::string& message) : runtime_error(message) {};
};

class OpcodeTest
{
public:
	const uint8_t HALT = 0x76;

public:
	OpDescriptor _noprefix[256] =
	{
		{ 0x00, false, false, 1, { 0x00, 0x00, 0x00, 0x00 },  4 },	// nop
		{ 0x01, false, false, 3, { 0x01, 0xF1, 0xF2, 0x00 }, 10 },	// ld bc, xxyy
		{ 0x02, false, false, 1, { 0x02, 0x00, 0x00, 0x00 },  7 },	// ld (bc), a
		{ 0x03, false, false, 1, { 0x03, 0x00, 0x00, 0x00 },  6 },	// inc bc
		{ 0x04, false, false, 1, { 0x04, 0x00, 0x00, 0x00 },  4 },	// inc b
		{ 0x05, false, false, 1, { 0x05, 0x00, 0x00, 0x00 },  4 },	// dec b
		{ 0x06, false, false, 2, { 0x06, 0xF1, 0x00, 0x00 },  7 },	// ld b, xx
		{ 0x07, false, false, 1, { 0x07, 0x00, 0x00, 0x00 },  4 },	// rlca
		{ 0x08, false, false, 1, { 0x08, 0x00, 0x00, 0x00 },  4 },	// ex af, af'
		{ 0x09, false, false, 1, { 0x09, 0x00, 0x00, 0x00 }, 11 },	// add hl, bc
		{ 0x0A, false, false, 1, { 0x0A, 0x00, 0x00, 0x00 },  7 },	// ld a, (bc)
		{ 0x0B, false, false, 1, { 0x0B, 0x00, 0x00, 0x00 },  6 },	// dec bc
		{ 0x0C, false, false, 1, { 0x0C, 0x00, 0x00, 0x00 },  4 },	// inc c
		{ 0x0D, false, false, 1, { 0x0D, 0x00, 0x00, 0x00 },  4 },	// dec c
		{ 0x0E, false, false, 2, { 0x0E, 0xF1, 0x00, 0x00 },  7 },	// ld c, xx
		{ 0x0F, false, false, 1, { 0x0F, 0x00, 0x00, 0x00 },  4 },	// rrca
		{ 0x10, false, true,  2, { 0x10, 0xF1, 0x00, 0x00 }, 13 },	// djnz xx
		{ 0x11, false, false, 3, { 0x11, 0xF1, 0xF2, 0x00 }, 10 },	// ld de, xxyy
		{ 0x12, false, false, 1, { 0x12, 0x00, 0x00, 0x00 },  7 },	// ld (de), a
		{ 0x13, false, false, 1, { 0x13, 0x00, 0x00, 0x00 },  6 },	// inc de
		{ 0x14, false, false, 1, { 0x14, 0x00, 0x00, 0x00 },  4 },	// inc d
		{ 0x15, false, false, 1, { 0x15, 0x00, 0x00, 0x00 },  4 },	// dec d
		{ 0x16, false, false, 1, { 0x16, 0xF1, 0x00, 0x00 },  7 },	// ld d, xx
		{ 0x17, false, false, 1, { 0x17, 0x00, 0x00, 0x00 },  4 },	// rla
		{ 0x18, false, false, 2, { 0x18, 0xF1, 0x00, 0x00 }, 12 },	// jr xx
		{ 0x19, false, false, 1, { 0x19, 0x00, 0x00, 0x00 }, 11 },	// add hl, de
		{ 0x1A, false, false, 1, { 0x1A, 0x00, 0x00, 0x00 },  7 },	// ld a, (de)
		{ 0x1B, false, false, 1, { 0x1B, 0x00, 0x00, 0x00 },  6 },	// dec de
		{ 0x1C, false, false, 1, { 0x1C, 0x00, 0x00, 0x00 },  4 },	// inc e
		{ 0x1D, false, false, 1, { 0x1D, 0x00, 0x00, 0x00 },  4 },	// dec e
		{ 0x1E, false, false, 2, { 0x1E, 0xF1, 0x00, 0x00 },  7 },	// ld e, xx
		{ 0x1F, false, false, 1, { 0x1F, 0x00, 0x00, 0x00 },  4 },	// rra
		{ 0x20, false, true,  2, { 0x20, 0xF1, 0x00, 0x00 },  7 },	// jr nz, xx
		{ 0x21, false, false, 3, { 0x21, 0xF1, 0xF2, 0x00 }, 10 },	// ld hl, xxyy
		{ 0x22, false, false, 3, { 0x22, 0xF1, 0xF2, 0x00 }, 16 },	// ld (xxyy), hl
		{ 0x23, false, false, 1, { 0x23, 0x00, 0x00, 0x00 },  6 },	// inc hl
		{ 0x24, false, false, 1, { 0x24, 0x00, 0x00, 0x00 },  4 },	// inc h
		{ 0x25, false, false, 1, { 0x25, 0x00, 0x00, 0x00 },  4 },	// dec h
		{ 0x26, false, false, 2, { 0x26, 0xF1, 0x00, 0x00 },  7 },	// ld h, xx
		{ 0x27, false, false, 1, { 0x27, 0x00, 0x00, 0x00 },  4 },	// daa
		{ 0x28, false, true,  2, { 0x28, 0xF1, 0x00, 0x00 }, 12 },	// jr z, xx
		{ 0x29, false, false, 1, { 0x29, 0x00, 0x00, 0x00 }, 11 },	// add hl, hl
		{ 0x2A, false, false, 3, { 0x2A, 0xF1, 0xF2, 0x00 }, 16 },	// ld hl, (xxyy)
		{ 0x2B, false, false, 1, { 0x2B, 0x00, 0x00, 0x00 },  6 },	// dec hl
		{ 0x2C, false, false, 1, { 0x2C, 0x00, 0x00, 0x00 },  4 },	// inc l
		{ 0x2D, false, false, 1, { 0x2D, 0x00, 0x00, 0x00 },  4 },	// dec l
		{ 0x2E, false, false, 2, { 0x2E, 0xF1, 0x00, 0x00 },  7 },	// ld l, xx
		{ 0x2F, false, false, 1, { 0x2F, 0x00, 0x00, 0x00 },  4 },	// cpl
		{ 0x30, false, true,  2, { 0x30, 0xF1, 0x00, 0x00 },  7 },	// jr nc, xx
		{ 0x31, false, false, 3, { 0x31, 0xF1, 0xF2, 0x00 }, 10 },	// ld sp, xxyy
		{ 0x32, false, false, 3, { 0x32, 0xF1, 0xF2, 0x00 }, 13 },	// ld (xxyy), a
		{ 0x33, false, false, 1, { 0x33, 0x00, 0x00, 0x00 },  6 },	// inc sp
		{ 0x34, false, false, 1, { 0x34, 0x00, 0x00, 0x00 }, 11 },	// inc (hl)
		{ 0x35, false, false, 1, { 0x35, 0x00, 0x00, 0x00 }, 11 },	// dec (hl)
		{ 0x36, false, false, 2, { 0x36, 0xF1, 0x00, 0x00 }, 10 },	// ld (hl), xx
		{ 0x37, false, false, 1, { 0x37, 0x00, 0x00, 0x00 },  4 },	// scf
		{ 0x38, false, true,  2, { 0x38, 0xF1, 0x00, 0x00 }, 12 },	// jr c, xx
		{ 0x39, false, false, 1, { 0x39, 0x00, 0x00, 0x00 }, 11 },	// add hl, sp
		{ 0x3A, false, false, 3, { 0x3A, 0xF1, 0xF2, 0x00 }, 13 },	// ld a, (xxyy)
		{ 0x3B, false, false, 1, { 0x3B, 0x00, 0x00, 0x00 },  6 },	// dec sp
		{ 0x3C, false, false, 1, { 0x3C, 0x00, 0x00, 0x00 },  4 },	// inc a
		{ 0x3D, false, false, 1, { 0x3D, 0x00, 0x00, 0x00 },  4 },	// dec a
		{ 0x3E, false, false, 2, { 0x3E, 0xF1, 0x00, 0x00 },  7 },	// ld a, xx
		{ 0x3F, false, false, 1, { 0x3F, 0x00, 0x00, 0x00 },  4 },	// ccf
		{ 0x40, false, false, 1, { 0x40, 0x00, 0x00, 0x00 },  4 },	// ld b, b
		{ 0x41, false, false, 1, { 0x41, 0x00, 0x00, 0x00 },  4 },	// ld b, c
		{ 0x42, false, false, 1, { 0x42, 0x00, 0x00, 0x00 },  4 },	// ld b, d
		{ 0x43, false, false, 1, { 0x43, 0x00, 0x00, 0x00 },  4 },	// ld b, e
		{ 0x44, false, false, 1, { 0x44, 0x00, 0x00, 0x00 },  4 },	// ld b, h
		{ 0x45, false, false, 1, { 0x45, 0x00, 0x00, 0x00 },  4 },	// ld b, l
		{ 0x46, false, false, 1, { 0x46, 0x00, 0x00, 0x00 },  7 },	// ld b, (hl)
		{ 0x47, false, false, 1, { 0x47, 0x00, 0x00, 0x00 },  4 },	// ld b, a
		{ 0x48, false, false, 1, { 0x48, 0x00, 0x00, 0x00 },  4 },	// ld c, b
		{ 0x49, false, false, 1, { 0x49, 0x00, 0x00, 0x00 },  4 },	// ld c, c
		{ 0x4A, false, false, 1, { 0x4A, 0x00, 0x00, 0x00 },  4 },	// ld c, d
		{ 0x4B, false, false, 1, { 0x4B, 0x00, 0x00, 0x00 },  4 },	// ld c, e
		{ 0x4C, false, false, 1, { 0x4C, 0x00, 0x00, 0x00 },  4 },	// ld c, h
		{ 0x4D, false, false, 1, { 0x4D, 0x00, 0x00, 0x00 },  4 },	// ld c, l
		{ 0x4E, false, false, 1, { 0x4E, 0x00, 0x00, 0x00 },  7 },	// ld c, (hl)
		{ 0x4F, false, false, 1, { 0x4F, 0x00, 0x00, 0x00 },  4 },	// ld c, a
		{ 0x50, false, false, 1, { 0x50, 0x00, 0x00, 0x00 },  4 },	// ld d, b
		{ 0x51, false, false, 1, { 0x51, 0x00, 0x00, 0x00 },  4 },	// ld d, c
		{ 0x52, false, false, 1, { 0x52, 0x00, 0x00, 0x00 },  4 },	// ld d, d
		{ 0x53, false, false, 1, { 0x53, 0x00, 0x00, 0x00 },  4 },	// ld d, e
		{ 0x54, false, false, 1, { 0x54, 0x00, 0x00, 0x00 },  4 },	// ld d, h
		{ 0x55, false, false, 1, { 0x55, 0x00, 0x00, 0x00 },  4 },	// ld d, l
		{ 0x56, false, false, 1, { 0x56, 0x00, 0x00, 0x00 },  7 },	// ld d, (hl)
		{ 0x57, false, false, 1, { 0x57, 0x00, 0x00, 0x00 },  4 },	// ld d, a
		{ 0x58, false, false, 1, { 0x58, 0x00, 0x00, 0x00 },  4 },	// ld e, b
		{ 0x59, false, false, 1, { 0x59, 0x00, 0x00, 0x00 },  4 },	// ld e, c
		{ 0x5A, false, false, 1, { 0x5A, 0x00, 0x00, 0x00 },  4 },	// ld e, d
		{ 0x5B, false, false, 1, { 0x5B, 0x00, 0x00, 0x00 },  4 },	// ld e, e
		{ 0x5C, false, false, 1, { 0x5C, 0x00, 0x00, 0x00 },  4 },	// ld e, h
		{ 0x5D, false, false, 1, { 0x5D, 0x00, 0x00, 0x00 },  4 },	// ld e, l
		{ 0x5E, false, false, 1, { 0x5E, 0x00, 0x00, 0x00 },  7 },	// ld e, (hl)
		{ 0x5F, false, false, 1, { 0x5F, 0x00, 0x00, 0x00 },  4 },	// ld e, a
		{ 0x60, false, false, 1, { 0x60, 0x00, 0x00, 0x00 },  4 },	// ld h, b
		{ 0x61, false, false, 1, { 0x61, 0x00, 0x00, 0x00 },  4 },	// ld h, c
		{ 0x62, false, false, 1, { 0x62, 0x00, 0x00, 0x00 },  4 },	// ld h, d
		{ 0x63, false, false, 1, { 0x63, 0x00, 0x00, 0x00 },  4 },	// ld h, e
		{ 0x64, false, false, 1, { 0x64, 0x00, 0x00, 0x00 },  4 },	// ld h, h
		{ 0x65, false, false, 1, { 0x65, 0x00, 0x00, 0x00 },  4 },	// ld h, l
		{ 0x66, false, false, 1, { 0x66, 0x00, 0x00, 0x00 },  7 },	// ld h, (hl)
		{ 0x67, false, false, 1, { 0x67, 0x00, 0x00, 0x00 },  4 },	// ld h, a
		{ 0x68, false, false, 1, { 0x68, 0x00, 0x00, 0x00 },  4 },	// ld l, b
		{ 0x69, false, false, 1, { 0x69, 0x00, 0x00, 0x00 },  4 },	// ld l, c
		{ 0x6A, false, false, 1, { 0x6A, 0x00, 0x00, 0x00 },  4 },	// ld l, d
		{ 0x6B, false, false, 1, { 0x6B, 0x00, 0x00, 0x00 },  4 },	// ld l, e
		{ 0x6C, false, false, 1, { 0x6C, 0x00, 0x00, 0x00 },  4 },	// ld l, h
		{ 0x6D, false, false, 1, { 0x6D, 0x00, 0x00, 0x00 },  4 },	// ld l, l
		{ 0x6E, false, false, 1, { 0x6E, 0x00, 0x00, 0x00 },  7 },	// ld l, (hl)
		{ 0x6F, false, false, 1, { 0x6F, 0x00, 0x00, 0x00 },  4 },	// ld l, a
		{ 0x70, false, false, 1, { 0x70, 0x00, 0x00, 0x00 },  7 },	// ld (hl), b
		{ 0x71, false, false, 1, { 0x71, 0x00, 0x00, 0x00 },  7 },	// ld (hl), c
		{ 0x72, false, false, 1, { 0x72, 0x00, 0x00, 0x00 },  7 },	// ld (hl), d
		{ 0x73, false, false, 1, { 0x73, 0x00, 0x00, 0x00 },  7 },	// ld (hl), e
		{ 0x74, false, false, 1, { 0x74, 0x00, 0x00, 0x00 },  7 },	// ld (hl), h
		{ 0x75, false, false, 1, { 0x75, 0x00, 0x00, 0x00 },  7 },	// ld (hl), l
		{ 0x76, false, false, 1, { 0x76, 0x00, 0x00, 0x00 },  4 },	// halt
		{ 0x77, false, false, 1, { 0x77, 0x00, 0x00, 0x00 },  7 },	// ld (hl), a
		{ 0x78, false, false, 1, { 0x78, 0x00, 0x00, 0x00 },  4 },	// ld a, b
		{ 0x79, false, false, 1, { 0x79, 0x00, 0x00, 0x00 },  4 },	// ld a, c
		{ 0x7A, false, false, 1, { 0x7A, 0x00, 0x00, 0x00 },  4 },	// ld a, d
		{ 0x7B, false, false, 1, { 0x7B, 0x00, 0x00, 0x00 },  4 },	// ld a, e
		{ 0x7C, false, false, 1, { 0x7C, 0x00, 0x00, 0x00 },  4 },	// ld a, h
		{ 0x7D, false, false, 1, { 0x7D, 0x00, 0x00, 0x00 },  4 },	// ld a, l
		{ 0x7E, false, false, 1, { 0x7E, 0x00, 0x00, 0x00 },  7 },	// ld a, (hl)
		{ 0x7F, false, false, 1, { 0x7F, 0x00, 0x00, 0x00 },  4 },	// ld a, a
		{ 0x80, false, false, 1, { 0x80, 0x00, 0x00, 0x00 },  4 },	// add a, b
		{ 0x81, false, false, 1, { 0x81, 0x00, 0x00, 0x00 },  4 },	// add a, c
		{ 0x82, false, false, 1, { 0x82, 0x00, 0x00, 0x00 },  4 },	// add a, d
		{ 0x83, false, false, 1, { 0x83, 0x00, 0x00, 0x00 },  4 },	// add a, e
		{ 0x84, false, false, 1, { 0x84, 0x00, 0x00, 0x00 },  4 },	// add a, h
		{ 0x85, false, false, 1, { 0x85, 0x00, 0x00, 0x00 },  4 },	// add a, l
		{ 0x86, false, false, 1, { 0x86, 0x00, 0x00, 0x00 },  7 },	// add a, (hl)
		{ 0x87, false, false, 1, { 0x87, 0x00, 0x00, 0x00 },  4 },	// add a, a
		{ 0x88, false, false, 1, { 0x88, 0x00, 0x00, 0x00 },  4 },	// adc a, b
		{ 0x89, false, false, 1, { 0x89, 0x00, 0x00, 0x00 },  4 },	// adc a, c
		{ 0x8A, false, false, 1, { 0x8A, 0x00, 0x00, 0x00 },  4 },	// adc a, d
		{ 0x8B, false, false, 1, { 0x8B, 0x00, 0x00, 0x00 },  4 },	// adc a, e
		{ 0x8C, false, false, 1, { 0x8C, 0x00, 0x00, 0x00 },  4 },	// adc a, h
		{ 0x8D, false, false, 1, { 0x8D, 0x00, 0x00, 0x00 },  4 },	// adc a, l
		{ 0x8E, false, false, 1, { 0x8E, 0x00, 0x00, 0x00 },  7 },	// adc a, (hl)
		{ 0x8F, false, false, 1, { 0x8F, 0x00, 0x00, 0x00 },  4 },	// adc a, a
		{ 0x90, false, false, 1, { 0x90, 0x00, 0x00, 0x00 },  4 },	// sub b
		{ 0x91, false, false, 1, { 0x91, 0x00, 0x00, 0x00 },  4 },	// sub c
		{ 0x92, false, false, 1, { 0x92, 0x00, 0x00, 0x00 },  4 },	// sub d
		{ 0x93, false, false, 1, { 0x93, 0x00, 0x00, 0x00 },  4 },	// sub e
		{ 0x94, false, false, 1, { 0x94, 0x00, 0x00, 0x00 },  4 },	// sub h
		{ 0x95, false, false, 1, { 0x95, 0x00, 0x00, 0x00 },  4 },	// sub l
		{ 0x96, false, false, 1, { 0x96, 0x00, 0x00, 0x00 },  7 },	// sub (hl)
		{ 0x97, false, false, 1, { 0x97, 0x00, 0x00, 0x00 },  4 },	// sub a
		{ 0x98, false, false, 1, { 0x98, 0x00, 0x00, 0x00 },  4 },	// sbc a, b
		{ 0x99, false, false, 1, { 0x99, 0x00, 0x00, 0x00 },  4 },	// sbc a, c
		{ 0x9A, false, false, 1, { 0x9A, 0x00, 0x00, 0x00 },  4 },	// sbc a, d
		{ 0x9B, false, false, 1, { 0x9B, 0x00, 0x00, 0x00 },  4 },	// sbc a, e
		{ 0x9C, false, false, 1, { 0x9C, 0x00, 0x00, 0x00 },  4 },	// sbc a, h
		{ 0x9D, false, false, 1, { 0x9D, 0x00, 0x00, 0x00 },  4 },	// sbc a, l
		{ 0x9E, false, false, 1, { 0x9E, 0x00, 0x00, 0x00 },  7 },	// sbc a, (hl)
		{ 0x9F, false, false, 1, { 0x9F, 0x00, 0x00, 0x00 },  4 },	// sbc a, a
		{ 0xA0, false, false, 1, { 0xA0, 0x00, 0x00, 0x00 },  4 },	// and b
		{ 0xA1, false, false, 1, { 0xA1, 0x00, 0x00, 0x00 },  4 },	// and c
		{ 0xA2, false, false, 1, { 0xA2, 0x00, 0x00, 0x00 },  4 },	// and d
		{ 0xA3, false, false, 1, { 0xA3, 0x00, 0x00, 0x00 },  4 },	// and e
		{ 0xA4, false, false, 1, { 0xA4, 0x00, 0x00, 0x00 },  4 },	// and h
		{ 0xA5, false, false, 1, { 0xA5, 0x00, 0x00, 0x00 },  4 },	// and l
		{ 0xA6, false, false, 1, { 0xA6, 0x00, 0x00, 0x00 },  7 },	// and (hl)
		{ 0xA7, false, false, 1, { 0xA7, 0x00, 0x00, 0x00 },  4 },	// and a
		{ 0xA8, false, false, 1, { 0xA8, 0x00, 0x00, 0x00 },  4 },	// xor b
		{ 0xA9, false, false, 1, { 0xA9, 0x00, 0x00, 0x00 },  4 },	// xor c
		{ 0xAA, false, false, 1, { 0xAA, 0x00, 0x00, 0x00 },  4 },	// xor d
		{ 0xAB, false, false, 1, { 0xAB, 0x00, 0x00, 0x00 },  4 },	// xor e
		{ 0xAC, false, false, 1, { 0xAC, 0x00, 0x00, 0x00 },  4 },	// xor h
		{ 0xAD, false, false, 1, { 0xAD, 0x00, 0x00, 0x00 },  4 },	// xor l
		{ 0xAE, false, false, 1, { 0xAE, 0x00, 0x00, 0x00 },  7 },	// xor (hl)
		{ 0xAF, false, false, 1, { 0xAF, 0x00, 0x00, 0x00 },  4 },	// xor a
		{ 0xB0, false, false, 1, { 0xB0, 0x00, 0x00, 0x00 },  4 },	// or b
		{ 0xB1, false, false, 1, { 0xB1, 0x00, 0x00, 0x00 },  4 },	// or c
		{ 0xB2, false, false, 1, { 0xB2, 0x00, 0x00, 0x00 },  4 },	// or d
		{ 0xB3, false, false, 1, { 0xB3, 0x00, 0x00, 0x00 },  4 },	// or e
		{ 0xB4, false, false, 1, { 0xB4, 0x00, 0x00, 0x00 },  4 },	// or h
		{ 0xB5, false, false, 1, { 0xB5, 0x00, 0x00, 0x00 },  4 },	// or l
		{ 0xB6, false, false, 1, { 0xB6, 0x00, 0x00, 0x00 },  7 },	// or (hl)
		{ 0xB7, false, false, 1, { 0xB7, 0x00, 0x00, 0x00 },  4 },	// or a
		{ 0xB8, false, false, 1, { 0xB8, 0x00, 0x00, 0x00 },  4 },	// cp b
		{ 0xB9, false, false, 1, { 0xB9, 0x00, 0x00, 0x00 },  4 },	// cp c
		{ 0xBA, false, false, 1, { 0xBA, 0x00, 0x00, 0x00 },  4 },	// cp d
		{ 0xBB, false, false, 1, { 0xBB, 0x00, 0x00, 0x00 },  4 },	// cp e
		{ 0xBC, false, false, 1, { 0xBC, 0x00, 0x00, 0x00 },  4 },	// cp h
		{ 0xBD, false, false, 1, { 0xBD, 0x00, 0x00, 0x00 },  4 },	// cp l
		{ 0xBE, false, false, 1, { 0xBE, 0x00, 0x00, 0x00 },  7 },	// cp (hl)
		{ 0xBF, false, false, 1, { 0xBF, 0x00, 0x00, 0x00 },  4 },	// cp a
		{ 0xC0, false, true,  1, { 0xC0, 0x00, 0x00, 0x00 },  5 },	// ret nz
		{ 0xC1, false, false, 1, { 0xC1, 0x00, 0x00, 0x00 }, 10 },	// pop bc
		{ 0xC2, false, true,  3, { 0xC2, 0xF1, 0xF2, 0x00 }, 10 },	// jp nz, xxyy
		{ 0xC3, false, false, 3, { 0xC3, 0xF1, 0xF2, 0x00 }, 10 },	// jp xxyy
		{ 0xC4, false, true,  3, { 0xC4, 0xF1, 0xF2, 0x00 }, 10 },	// call nz, xxyy
		{ 0xC5, false, false, 1, { 0xC5, 0x00, 0x00, 0x00 }, 11 },	// push bc
		{ 0xC6, false, false, 2, { 0xC6, 0xF1, 0x00, 0x00 },  7 },	// add a, xx
		{ 0xC7, false, false, 1, { 0xC7, 0x00, 0x00, 0x00 }, 11 },	// rst 00h
		{ 0xC8, false, true,  1, { 0xC8, 0x00, 0x00, 0x00 }, 11 },	// ret z
		{ 0xC9, false, false, 1, { 0xC9, 0x00, 0x00, 0x00 }, 10 },	// ret
		{ 0xCA, false, false, 3, { 0xCA, 0xF1, 0xF2, 0x00 }, 10 },	// jp z, xxyy
		{ 0xCB, false, false, 0, { 0xCB, 0x00, 0x00, 0x00 },  0 },	// 0xCB PREFIX - Bits operations
		{ 0xCC, false, true,  3, { 0xCC, 0xF1, 0xF2, 0x00 }, 17 },	// call z, xxyy
		{ 0xCD, false, false, 3, { 0xCD, 0xF1, 0xF2, 0x00 }, 17 },	// call xxyy
		{ 0xCE, false, false, 2, { 0xCE, 0xF1, 0x00, 0x00 },  7 },	// adc a, xx
		{ 0xCF, false, false, 1, { 0xCF, 0x00, 0x00, 0x00 }, 11 },	// rst 08h
		{ 0xD0, false, true,  1, { 0xD0, 0x00, 0x00, 0x00 },  5 },	// ret nc
		{ 0xD1, false, false, 1, { 0xD1, 0x00, 0x00, 0x00 }, 10 },	// pop de
		{ 0xD2, false, false, 3, { 0xD2, 0xF1, 0xF2, 0x00 }, 10 },	// jp nc, xxyy
		{ 0xD3, false, false, 2, { 0xD3, 0xF1, 0x00, 0x00 }, 11 },	// out (xx), a
		{ 0xD4, false, true,  3, { 0xD4, 0xF1, 0xF2, 0x00 }, 10 },	// call nc, xxyy
		{ 0xD5, false, false, 1, { 0xD5, 0x00, 0x00, 0x00 }, 11 },	// push de
		{ 0xD6, false, false, 2, { 0xD6, 0xF1, 0x00, 0x00 },  7 },	// sub xx
		{ 0xD7, false, false, 1, { 0xD7, 0x00, 0x00, 0x00 }, 11 },	// rst 10h
		{ 0xD8, false, true,  1, { 0xD8, 0x00, 0x00, 0x00 }, 11 },	// ret c
		{ 0xD9, false, false, 1, { 0xD9, 0x00, 0x00, 0x00 },  4 },	// exx
		{ 0xDA, false, false, 3, { 0xDA, 0xF1, 0xF2, 0x00 }, 10 },	// jp c, xxyy
		{ 0xDB, false, false, 2, { 0xDB, 0xF1, 0x00, 0x00 }, 11 },	// in a, (*)
		{ 0xDC, false, true,  3, { 0xDC, 0xF1, 0xF2, 0x00 }, 17 },	// call c, xxyy
		{ 0xDD, false, false, 0, { 0xDD, 0x00, 0x00, 0x00 },  0 },	// 0xDD PREFIX - IX addressed operations
		{ 0xDE, false, false, 2, { 0xDE, 0xF1, 0x00, 0x00 },  7 },	// sbc a, xx
		{ 0xDF, false, false, 1, { 0xDF, 0x00, 0x00, 0x00 }, 11 },	// rst 18h
		{ 0xE0, false, true,  1, { 0xE0, 0x00, 0x00, 0x00 },  5 },	// ret po
		{ 0xE1, false, false, 1, { 0xE1, 0x00, 0x00, 0x00 }, 10 },	// pop hl
		{ 0xE2, false, false, 3, { 0xE2, 0xF1, 0xF2, 0x00 }, 10 },	// jp po, xxyy
		{ 0xE3, false, false, 1, { 0xE3, 0x00, 0x00, 0x00 }, 19 },	// ex (sp), hl
		{ 0xE4, false, true,  3, { 0xE4, 0xF1, 0xF2, 0x00 }, 10 },	// call po, xxyy
		{ 0xE5, false, false, 1, { 0xE5, 0x00, 0x00, 0x00 }, 11 },	// push hl
		{ 0xE6, false, false, 2, { 0xE6, 0xF1, 0x00, 0x00 },  7 },	// and xx
		{ 0xE7, false, false, 1, { 0xE7, 0x00, 0x00, 0x00 }, 11 },	// rst 20h
		{ 0xE8, false, true,  1, { 0xE8, 0x00, 0x00, 0x00 },  11 },	// ret pe
		{ 0xE9, false, false, 1, { 0xE9, 0x00, 0x00, 0x00 },  4 },	// jp (hl)
		{ 0xEA, false, false, 3, { 0xEA, 0xF1, 0xF2, 0x00 }, 10 },	// jp pe, xxyy
		{ 0xEB, false, false, 1, { 0xEB, 0x00, 0x00, 0x00 },  4 },	// ex dl, hl
		{ 0xEC, false, true,  3, { 0xEC, 0xF1, 0xF2, 0x00 }, 17 },	// call pe, xxyy
		{ 0xED, false, false, 0, { 0xED, 0x00, 0x00, 0x00 },  0 },	// DD PREFIX - Extension operations
		{ 0xEE, false, false, 2, { 0xEE, 0xF1, 0x00, 0x00 },  7 },	// xor xx
		{ 0xEF, false, false, 1, { 0xEF, 0x00, 0x00, 0x00 }, 11 },	// rst 28h
		{ 0xF0, false, true,  1, { 0xF0, 0x00, 0x00, 0x00 },  5 },	// ret p
		{ 0xF1, false, false, 1, { 0xF1, 0x00, 0x00, 0x00 }, 10 },	// pop af
		{ 0xF2, false, false, 3, { 0xF2, 0xF1, 0xF2, 0x00 }, 10 },	// jp p, xxyy
		{ 0xF3, false, false, 1, { 0xF3, 0x00, 0x00, 0x00 },  4 },	// di
		{ 0xF4, false, true,  3, { 0xF4, 0xF1, 0xF2, 0x00 }, 10 },	// call p, xxyy
		{ 0xF5, false, false, 1, { 0xF5, 0x00, 0x00, 0x00 }, 11 },	// push af
		{ 0xF6, false, false, 1, { 0xF6, 0xF1, 0x00, 0x00 },  7 },	// or xx
		{ 0xF7, false, false, 1, { 0xF7, 0x00, 0x00, 0x00 }, 11 },	// rst 30h
		{ 0xF8, false, true,  1, { 0xF8, 0x00, 0x00, 0x00 }, 11 },	// ret m
		{ 0xF9, false, false, 1, { 0xF9, 0x00, 0x00, 0x00 },  6 },	// ld sp, hl
		{ 0xFA, false, false, 3, { 0xFA, 0xF1, 0xF2, 0x00 }, 10 },	// jp m, xxyy
		{ 0xFB, false, false, 1, { 0xFB, 0x00, 0x00, 0x00 },  4 },	// ei
		{ 0xFC, false, true,  3, { 0xFC, 0xF1, 0xF2, 0x00 }, 17 },	// call m, xxyy
		{ 0xFD, false, false, 0, { 0xFD, 0x00, 0x00, 0x00 },  0 },	// FD PREFIX - IY addressed operations
		{ 0xFE, false, false, 2, { 0xFE, 0xF1, 0x00, 0x00 },  7 },	// cp xx
		{ 0xFF, false, false, 1, { 0xFF, 0x00, 0x00, 0x00 }, 11 }	// rst 38h
	};

	std::map<uint8_t, ConditionalTimings> _noprefix_conditional;

public:
	OpcodeTest();
	[[nodiscard]] uint8_t PrepareInstruction(uint8_t prefix, uint8_t opcode, uint8_t* memory);
};

} // namespace z80_test